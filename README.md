# Day Translation Core æ¨¡å—æ¶æ„æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

`day_translation` å·¥å…·æ˜¯ä¸€ä¸ªä¸“ä¸º RimWorld æ¨¡ç»„è®¾è®¡çš„ç¿»è¯‘å·¥å…·åŒ…ï¼Œé‡‡ç”¨æ¨¡å—åŒ–æ¶æ„ï¼ŒåŒ…å«ç¿»è¯‘æ•°æ®çš„æå–ã€å¤„ç†ã€ç”Ÿæˆã€å¯¼å‡ºå’Œå¯¼å…¥åŠŸèƒ½ã€‚è¯¥å·¥å…·æ”¯æŒå¤šç§ç¿»è¯‘å·¥ä½œæµç¨‹ï¼Œæä¾›æ™ºèƒ½åˆå¹¶ã€æ¨¡æ¿ç”Ÿæˆç­‰é«˜çº§åŠŸèƒ½ã€‚

## âœ¨ æœ€æ–°åŠŸèƒ½

### ğŸ¯ ç»Ÿä¸€è¿›åº¦æ¡ç³»ç»Ÿ
- æ‰€æœ‰æå–å’Œå¯¼å‡ºæ“ä½œéƒ½é…å¤‡å®æ—¶è¿›åº¦æ¡
- æ¸…æ™°çš„è¿›åº¦ç™¾åˆ†æ¯”å’Œæ–‡ä»¶æ•°é‡æ˜¾ç¤º
- ç»Ÿä¸€çš„ç”¨æˆ·ä½“éªŒå’Œç•Œé¢é£æ ¼

### ğŸ”§ ä»£ç è´¨é‡ä¼˜åŒ–
- ç»Ÿä¸€çš„å¯¼å…¥ç®¡ç†ï¼Œé¿å…é‡å¤å¯¼å…¥
- ä¼˜åŒ–çš„é”™è¯¯å¤„ç†å’Œå‚æ•°è§£åŒ…
- æ›´æ¸…æ™°çš„ä»£ç ç»“æ„å’Œç»´æŠ¤æ€§

### ğŸ“Š æ™ºèƒ½æå–æµç¨‹
- è‡ªåŠ¨æ£€æµ‹è¾“å…¥ç›®å½•ç»“æ„
- æ”¯æŒKeyedã€DefInjectedã€Defså¤šç§æå–æ¨¡å¼
- æ™ºèƒ½ç»„åˆæå–å’Œå¯¼å‡ºé€‰é¡¹

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

```
day_translation/
â”œâ”€â”€ main.py                      # ä¸»å…¥å£
â”œâ”€â”€ core/                        # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ translation_facade.py    # ç¿»è¯‘é—¨é¢ - ç»Ÿä¸€æ¥å£
â”‚   â”œâ”€â”€ exceptions.py            # å¼‚å¸¸å®šä¹‰
â”‚   â”œâ”€â”€ API_CALLS.md             # APIæ¥å£æ–‡æ¡£
â”‚   â””â”€â”€ QUICK_REFERENCE.md       # å¿«é€Ÿå‚è€ƒ
â”œâ”€â”€ extract/                     # æå–æ¨¡å—
â”‚   â”œâ”€â”€ core/                    # æ ¸å¿ƒæå–ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ extractors/          # æå–å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py          # åŸºç¡€æå–å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ keyed.py         # Keyedæå–å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ definjected.py   # DefInjectedæå–å™¨
â”‚   â”‚   â”‚   â””â”€â”€ defs.py          # Defsæ‰«æå™¨
â”‚   â”‚   â”œâ”€â”€ exporters/           # å¯¼å‡ºå™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py          # åŸºç¡€å¯¼å‡ºå™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ keyed.py         # Keyedå¯¼å‡ºå™¨
â”‚   â”‚   â”‚   â””â”€â”€ definjected.py   # DefInjectedå¯¼å‡ºå™¨
â”‚   â”‚   â””â”€â”€ filters/             # å†…å®¹è¿‡æ»¤å™¨
â”‚   â”‚       â”œâ”€â”€ content_filter.py    # å†…å®¹è¿‡æ»¤å™¨
â”‚   â”‚       â””â”€â”€ text_validator.py    # æ–‡æœ¬éªŒè¯å™¨
â”‚   â”œâ”€â”€ workflow/                # å·¥ä½œæµç¨‹ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ manager.py           # æ¨¡æ¿ç®¡ç†å™¨ - æ ¸å¿ƒæ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ handler.py           # å¤„ç†å™¨ - ä¸»è¦ä¸šåŠ¡æµç¨‹
â”‚   â”‚   â””â”€â”€ interaction.py       # äº¤äº’ç®¡ç†å™¨
â”‚   â”œâ”€â”€ utils/                   # æå–å·¥å…·
â”‚   â”‚   â””â”€â”€ merger.py            # æ™ºèƒ½åˆå¹¶å™¨
â”‚   â””â”€â”€ docs/                    # æ–‡æ¡£
â”‚       â””â”€â”€ merge_flow.md        # åˆå¹¶æµç¨‹æ–‡æ¡£
â”œâ”€â”€ import_template/             # å¯¼å…¥æ¨¡å—
â”‚   â”œâ”€â”€ importers.py             # å¯¼å…¥å™¨ - CSVåˆ°XMLè½¬æ¢
â”‚   â””â”€â”€ handler.py               # å¯¼å…¥å¤„ç†å™¨
â”œâ”€â”€ translate/                   # ç¿»è¯‘æ¨¡å—
â”‚   â”œâ”€â”€ core/                    # ç¿»è¯‘æ ¸å¿ƒ
â”‚   â”‚   â”œâ”€â”€ unified_translator.py    # ç»Ÿä¸€ç¿»è¯‘å™¨
â”‚   â”‚   â”œâ”€â”€ translator_factory.py   # ç¿»è¯‘å™¨å·¥å‚
â”‚   â”‚   â”œâ”€â”€ translation_config.py   # ç¿»è¯‘é…ç½®
â”‚   â”‚   â”œâ”€â”€ java_translator.py      # Javaç¿»è¯‘å™¨
â”‚   â”‚   â””â”€â”€ python_translator.py    # Pythonç¿»è¯‘å™¨
â”‚   â”œâ”€â”€ handler.py               # ç¿»è¯‘å¤„ç†å™¨
â”‚   â””â”€â”€ MIGRATION_GUIDE.md       # è¿ç§»æŒ‡å—
â”œâ”€â”€ batch/                       # æ‰¹é‡å¤„ç†æ¨¡å—
â”‚   â”œâ”€â”€ batch_processor.py       # æ‰¹é‡å¤„ç†å™¨
â”‚   â””â”€â”€ handler.py               # æ‰¹é‡å¤„ç†å¤„ç†å™¨
â”œâ”€â”€ full_pipeline/               # å®Œæ•´æµç¨‹æ¨¡å—
â”‚   â””â”€â”€ handler.py               # å®Œæ•´æµç¨‹å¤„ç†å™¨
â”œâ”€â”€ corpus/                      # è¯­æ–™åº“æ¨¡å—
â”‚   â”œâ”€â”€ parallel_corpus.py       # å¹³è¡Œè¯­æ–™åº“
â”‚   â””â”€â”€ handler.py               # è¯­æ–™åº“å¤„ç†å™¨
â”œâ”€â”€ config_manage/               # é…ç½®ç®¡ç†æ¨¡å—
â”‚   â””â”€â”€ handler.py               # é…ç½®ç®¡ç†å¤„ç†å™¨
â”œâ”€â”€ java_translate/              # Javaç¿»è¯‘æ¨¡å—
â”‚   â””â”€â”€ RimWorldBatchTranslate/  # Javaæ‰¹é‡ç¿»è¯‘å·¥å…·
â”œâ”€â”€ utils/                       # å·¥å…·æ¨¡å—
â”‚   â”œâ”€â”€ config.py                # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ utils.py                 # å·¥å…·å‡½æ•°å’ŒXMLProcessor
â”‚   â”œâ”€â”€ ui_style.py              # UIæ ·å¼å’Œè¿›åº¦æ¡
â”‚   â”œâ”€â”€ interaction.py           # äº¤äº’å·¥å…·
â”‚   â”œâ”€â”€ logging_config.py        # æ—¥å¿—é…ç½®
â”‚   â””â”€â”€ path_manager.py          # è·¯å¾„ç®¡ç†
â”œâ”€â”€ logs/                        # æ—¥å¿—ç›®å½•
â”œâ”€â”€ requirements.txt             # ä¾èµ–åŒ…
â”œâ”€â”€ pyproject.toml              # é¡¹ç›®é…ç½®
â””â”€â”€ æ–‡æ¡£æ–‡ä»¶/
    â”œâ”€â”€ PROGRESS_BAR_GUIDE.md    # è¿›åº¦æ¡åŠŸèƒ½æŒ‡å—
    â”œâ”€â”€ EXTRACTION_GUIDE.md      # ç¿»è¯‘æå–æŒ‡å—
    â””â”€â”€ UI_IMPROVEMENTS.md       # UIæ”¹è¿›è®°å½•
```

## ğŸ“Š æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 1. extract/workflow/manager.py - æ¨¡æ¿ç®¡ç†å™¨

**èŒè´£**: ç¿»è¯‘æ¨¡æ¿çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œåè°ƒå„ä¸ªç»„ä»¶å®Œæˆå¤æ‚çš„ç¿»è¯‘æå–å’Œç”Ÿæˆæµç¨‹

**ä¸»è¦åŠŸèƒ½**:
- `extract_all_translations()`: æ™ºèƒ½æå–æ‰€æœ‰ç¿»è¯‘æ•°æ®
- `_generate_templates_to_output_dir_with_structure()`: ç”Ÿæˆæ¨¡æ¿åˆ°è¾“å‡ºç›®å½•
- `_save_translations_to_csv()`: ä¿å­˜ç¿»è¯‘æ•°æ®åˆ°CSV
- `_generate_definjected_with_structure()`: æ ¹æ®ç»“æ„ç”ŸæˆDefInjectedæ¨¡æ¿

**æ™ºèƒ½æµç¨‹å†³ç­–**:
- è‡ªåŠ¨æ£€æµ‹è¾“å…¥ç›®å½•ç»“æ„
- æ”¯æŒKeyedã€DefInjectedã€Defså¤šç§æå–æ¨¡å¼
- æ™ºèƒ½ç»„åˆæå–å’Œå¯¼å‡ºé€‰é¡¹

### 2. extract/core/extractors/ - æå–å™¨æ¨¡å—

**KeyedExtractor**: ä»Keyedç›®å½•æå–é”®å€¼å¯¹ç¿»è¯‘
- æ”¯æŒè‡ªå®šä¹‰æ ‡ç­¾å
- ä¸é™åˆ¶default_fields
- é…å¤‡è¿›åº¦æ¡æ˜¾ç¤º

**DefInjectedExtractor**: ä»DefInjectedç›®å½•æå–ç¿»è¯‘ç»“æ„
- æ”¯æŒå¤æ‚çš„ç¿»è¯‘ç»“æ„
- åŒ…å«DefTypeä¿¡æ¯
- é…å¤‡è¿›åº¦æ¡æ˜¾ç¤º

**DefsScanner**: ä»Defsç›®å½•é‡æ–°æå–ç¿»è¯‘
- ç›´æ¥ä»æ¸¸æˆDefsæ–‡ä»¶æå–
- æ”¯æŒæ‰€æœ‰DefType
- é…å¤‡è¿›åº¦æ¡æ˜¾ç¤º

### 3. extract/core/exporters/ - å¯¼å‡ºå™¨æ¨¡å—

**KeyedExporter**: å¯¼å‡ºKeyedæ ¼å¼çš„ç¿»è¯‘æ–‡ä»¶
- ç”ŸæˆKeyedæ¨¡æ¿
- é…å¤‡è¿›åº¦æ¡æ˜¾ç¤º

**DefInjectedExporter**: å¯¼å‡ºDefInjectedæ ¼å¼çš„ç¿»è¯‘æ–‡ä»¶
- `export_with_original_structure()`: æŒ‰åŸå§‹æ–‡ä»¶è·¯å¾„ç»“æ„å¯¼å‡º
- `export_with_defs_structure()`: æŒ‰DefTypeåˆ†ç±»å¯¼å‡º
- `export_with_file_structure()`: æŒ‰æ–‡ä»¶ç›®å½•ç»“æ„å¯¼å‡º
- æ‰€æœ‰æ–¹æ³•éƒ½é…å¤‡è¿›åº¦æ¡æ˜¾ç¤º

### 4. utils/ui_style.py - UIæ ·å¼å’Œè¿›åº¦æ¡

**ç»Ÿä¸€è¿›åº¦æ¡ç³»ç»Ÿ**:
- `ui.iter_with_progress()`: å¸¦è¿›åº¦æ¡çš„è¿­ä»£å™¨
- `ui.ProgressBar`: è¿›åº¦æ¡ä¸Šä¸‹æ–‡ç®¡ç†å™¨
- `ui.print_progress_bar()`: æ‰‹åŠ¨è¿›åº¦æ¡æ˜¾ç¤º

**ç‰¹æ€§**:
- è‡ªåŠ¨æ˜¾ç¤ºè¿›åº¦ç™¾åˆ†æ¯”å’Œæ–‡ä»¶æ•°é‡
- æ”¯æŒè‡ªå®šä¹‰å‰ç¼€å’Œæè¿°ä¿¡æ¯
- ç»Ÿä¸€çš„ç”¨æˆ·ä½“éªŒå’Œç•Œé¢é£æ ¼

## ğŸ”„ ä¸»è¦å·¥ä½œæµç¨‹

### æµç¨‹1: æ™ºèƒ½æå–å’Œæ¨¡æ¿ç”Ÿæˆ

```python
# ç”¨æˆ·æ“ä½œ: æ¨¡å¼1 - ç”Ÿæˆæ¨¡æ¿å’ŒCSV
main() 
â””â”€â”€ TranslationFacade.extract_templates_and_generate_csv()
    â””â”€â”€ TemplateManager.extract_all_translations()
        â”œâ”€â”€ KeyedExtractor.extract()           # æå–Keyedç¿»è¯‘
        â”œâ”€â”€ DefInjectedExtractor.extract()     # æå–DefInjectedç¿»è¯‘
        â””â”€â”€ DefsScanner.extract()              # æ‰«æDefsæ–‡ä»¶
        â””â”€â”€ TemplateManager._generate_templates_to_output_dir_with_structure()
            â”œâ”€â”€ KeyedExporter.export_keyed_template()      # ç”ŸæˆKeyedæ¨¡æ¿
            â””â”€â”€ DefInjectedExporter.export_*()             # ç”ŸæˆDefInjectedæ¨¡æ¿
        â””â”€â”€ TemplateManager._save_translations_to_csv()    # å¯¼å‡ºCSV
```

### æµç¨‹2: ç¿»è¯‘å¯¼å…¥

```python
# ç”¨æˆ·æ“ä½œ: æ¨¡å¼3 - å¯¼å…¥ç¿»è¯‘
main()
â””â”€â”€ TranslationFacade.import_translations_to_templates()
    â””â”€â”€ TemplateManager.import_translations()
        â”œâ”€â”€ _validate_csv_file()           # éªŒè¯CSVæ–‡ä»¶
        â”œâ”€â”€ _load_translations_from_csv()  # åŠ è½½ç¿»è¯‘æ•°æ®
        â”œâ”€â”€ _update_all_xml_files()        # æ›´æ–°XMLæ–‡ä»¶
        â””â”€â”€ _verify_import_results()       # éªŒè¯å¯¼å…¥ç»“æœ
```

### æµç¨‹3: å®Œæ•´ç¿»è¯‘æµç¨‹

```python
# ç”¨æˆ·æ“ä½œ: æ¨¡å¼7 - å®Œæ•´æµç¨‹
main()
â””â”€â”€ FullPipelineHandler.handle_full_pipeline()
    â”œâ”€â”€ æå–ç¿»è¯‘æ•°æ®
    â”œâ”€â”€ ç”Ÿæˆç¿»è¯‘æ¨¡æ¿
    â”œâ”€â”€ å¯¼å‡ºCSVæ–‡ä»¶
    â”œâ”€â”€ æœºå™¨ç¿»è¯‘
    â””â”€â”€ å¯¼å…¥ç¿»è¯‘ç»“æœ
```

## ğŸ¯ è¿›åº¦æ¡ç³»ç»Ÿ

### è¦†ç›–èŒƒå›´
- âœ… **æ‰€æœ‰æå–å™¨**: Keyedã€DefInjectedã€Defs
- âœ… **æ‰€æœ‰å¯¼å‡ºå™¨**: Keyedã€DefInjected (æ‰€æœ‰å¯¼å‡ºæ–¹æ³•)
- âœ… **CSVå¯¼å‡º**: ç¿»è¯‘æ•°æ®å¯¼å‡º
- âœ… **æ–‡ä»¶å¤„ç†**: æ‰¹é‡æ–‡ä»¶æ“ä½œ

### æ˜¾ç¤ºæ•ˆæœ
```
â„¹ï¸ æ­£åœ¨æ‰«æ Keyed ç›®å½•ä¸­çš„ 2 ä¸ªæ–‡ä»¶...
æ‰«æKeyed: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100.0% (2/2) â„¹ï¸ 
âœ… ä»Keyed ç›®å½•æå–åˆ° 52 æ¡ Keyed ç¿»è¯‘

â„¹ï¸ æ­£åœ¨ç”Ÿæˆ DefInjected æ¨¡æ¿ä¸­çš„ 25 ä¸ªæ–‡ä»¶...
ç”ŸæˆDefInjected: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100.0% (25/25) â„¹ï¸ 
âœ… DefInjected æ¨¡æ¿å·²ç”Ÿæˆï¼ˆæŒ‰æ–‡ä»¶ç»“æ„ï¼‰
```

## ğŸ› ï¸ æŠ€æœ¯ç‰¹æ€§

### æ™ºèƒ½å†…å®¹è¿‡æ»¤
- **éæ–‡æœ¬è¿‡æ»¤**: è‡ªåŠ¨è¿‡æ»¤æ•°å­—ã€å¸ƒå°”å€¼ç­‰éæ–‡æœ¬å†…å®¹
- **å¿½ç•¥å­—æ®µ**: å¯é…ç½®å¿½ç•¥ç‰¹å®šå­—æ®µ
- **é»˜è®¤å­—æ®µæ£€æŸ¥**: DefInjectedæ¨¡å¼æ£€æŸ¥é»˜è®¤å­—æ®µ

### é”™è¯¯å¤„ç†
- **ç›®å½•æ£€æŸ¥**: è‡ªåŠ¨æ£€æŸ¥å¹¶æç¤ºç›®å½•å­˜åœ¨æ€§
- **æ–‡ä»¶æ ¼å¼éªŒè¯**: è·³è¿‡æ— æ•ˆæ–‡ä»¶å¹¶æä¾›è¯¦ç»†é”™è¯¯ä¿¡æ¯
- **æƒé™å¤„ç†**: æä¾›è¯¦ç»†çš„æƒé™é”™è¯¯ä¿¡æ¯

### æ€§èƒ½ä¼˜åŒ–
- **è¿›åº¦æ¡ä¼˜åŒ–**: ä¸å½±å“å¤„ç†æ€§èƒ½
- **å†…å­˜ç®¡ç†**: ä¼˜åŒ–çš„å†…å­˜ä½¿ç”¨
- **æ‰¹é‡å¤„ç†**: æ”¯æŒå¤§é‡æ–‡ä»¶çš„é«˜æ•ˆå¤„ç†

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [è¿›åº¦æ¡åŠŸèƒ½æŒ‡å—](PROGRESS_BAR_GUIDE.md) - è¯¦ç»†çš„è¿›åº¦æ¡ä½¿ç”¨è¯´æ˜
- [ç¿»è¯‘æå–æŒ‡å—](EXTRACTION_GUIDE.md) - æå–åŠŸèƒ½å®Œæ•´æŒ‡å—
- [UIæ”¹è¿›è®°å½•](UI_IMPROVEMENTS.md) - UI/UXæ”¹è¿›å†ç¨‹
- [å¿«é€Ÿå‚è€ƒ](core/QUICK_REFERENCE.md) - æ ¸å¿ƒåŠŸèƒ½å¿«é€Ÿå‚è€ƒ
- [APIè°ƒç”¨](core/API_CALLS.md) - APIæ¥å£æ–‡æ¡£
- [è¿ç§»æŒ‡å—](translate/MIGRATION_GUIDE.md) - ç‰ˆæœ¬è¿ç§»è¯´æ˜

## ğŸš€ å¿«é€Ÿå¼€å§‹

1. **å®‰è£…ä¾èµ–**: `pip install -r requirements.txt`
2. **è¿è¡Œä¸»ç¨‹åº**: `python main.py`
3. **é€‰æ‹©æ¨¡å¼**: æ ¹æ®éœ€æ±‚é€‰æ‹©ç›¸åº”çš„å¤„ç†æ¨¡å¼
4. **æŸ¥çœ‹è¿›åº¦**: æ‰€æœ‰æ“ä½œéƒ½é…å¤‡å®æ—¶è¿›åº¦æ¡æ˜¾ç¤º

Day Translation Core æ¨¡å—é‡‡ç”¨äº†æ¸…æ™°çš„åˆ†å±‚æ¶æ„å’Œæ¨¡å—åŒ–è®¾è®¡ï¼Œé€šè¿‡åˆç†çš„èŒè´£åˆ†ç¦»å’Œæ¥å£è®¾è®¡ï¼Œå®ç°äº†é«˜å†…èšã€ä½è€¦åˆçš„ä»£ç ç»“æ„ã€‚è¿™ç§è®¾è®¡ä¸ä»…ä¾¿äºç»´æŠ¤å’Œæ‰©å±•ï¼Œè¿˜ä¸ºç”¨æˆ·æä¾›äº†çµæ´»ã€å¼ºå¤§çš„ç¿»è¯‘å¤„ç†èƒ½åŠ›ã€‚