# æå–æ¨¡æ¿åŠŸèƒ½å®Œæ•´é‡è®¾è®¡æ–¹æ¡ˆ

## ğŸ“‹ **å½“å‰é—®é¢˜åˆ†æ**

### ç°æœ‰æµç¨‹çš„é—®é¢˜
1. **é‡å¤è¯¢é—®**ï¼šç”¨æˆ·éœ€è¦åœ¨å¤šä¸ªåœ°æ–¹é‡å¤é€‰æ‹©ç›¸ä¼¼çš„é€‰é¡¹
2. **æµç¨‹æ··ä¹±**ï¼šç¼ºä¹æ¸…æ™°çš„çŠ¶æ€æ£€æµ‹å’Œæ¡ä»¶åŒ–å¤„ç†
3. **ç”¨æˆ·å›°æƒ‘**ï¼šé€‰é¡¹å«ä¹‰ä¸æ˜ç¡®ï¼Œç¼ºå°‘çŠ¶æ€åé¦ˆ
4. **é€»è¾‘å†²çª**ï¼šæŸäº›é€‰æ‹©ç»„åˆä¼šå¯¼è‡´ä¸åˆç†çš„ç»“æœ

### ç”¨æˆ·åé¦ˆçš„æ ¸å¿ƒé—®é¢˜
- "ä»¥è‹±æ–‡ DefInjected ä¸ºåŸºç¡€"åŠŸèƒ½ä»ç„¶é”™è¯¯
- ç¼ºå°‘æ¸…æ™°çš„ç¯å¢ƒçŠ¶æ€æ£€æµ‹
- é€‰é¡¹å¤ªå¤šä¸”é‡å¤ï¼Œç”¨æˆ·ä½“éªŒå·®
- ç¼ºå°‘å†²çªå¤„ç†å’Œå¤‡ä»½æœºåˆ¶

## ğŸ¯ **ç”¨æˆ·å»ºè®®çš„å®Œæ•´è§£å†³æ–¹æ¡ˆ**

### **ç¬¬ä¸€æ­¥ï¼šå…¨é¢çŠ¶æ€æ£€æµ‹**
```
ğŸ” æ­£åœ¨æ£€æµ‹æ¨¡ç»„å’Œè¾“å‡ºç›®å½•çŠ¶æ€...
[â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100%

ğŸ“Š æ£€æµ‹ç»“æœæ‘˜è¦ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‚ æ¨¡ç»„ç¿»è¯‘èµ„æºæ£€æµ‹ï¼š                    â”‚
â”‚    è‹±æ–‡ DefInjected ç›®å½•: âœ… å·²æ‰¾åˆ°      â”‚
â”‚    â””â”€â”€ è·¯å¾„: mod/Languages/English/DefInjected â”‚
â”‚    â””â”€â”€ åŒ…å«æ–‡ä»¶: 25 ä¸ªç¿»è¯‘æ–‡ä»¶           â”‚
â”‚                                         â”‚
â”‚    è‹±æ–‡ Keyed ç›®å½•: âœ… å·²æ‰¾åˆ°           â”‚
â”‚    â””â”€â”€ è·¯å¾„: mod/Languages/English/Keyed â”‚
â”‚    â””â”€â”€ åŒ…å«æ–‡ä»¶: 8 ä¸ªç¿»è¯‘æ–‡ä»¶            â”‚
â”‚                                         â”‚
â”‚ ğŸ“ è¾“å‡ºç›®å½•çŠ¶æ€æ£€æµ‹ï¼š                    â”‚
â”‚    è¾“å‡º DefInjected ç›®å½•: âŒ ä¸å­˜åœ¨      â”‚
â”‚    è¾“å‡º Keyed ç›®å½•: âŒ ä¸å­˜åœ¨           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **ç¬¬äºŒæ­¥ï¼šæ•°æ®æ¥æºé€‰æ‹©**ï¼ˆæ¡ä»¶åŒ–ï¼‰

#### æƒ…å†µAï¼šæ£€æµ‹åˆ°è‹±æ–‡ DefInjected ç›®å½•
```
âœ… æ£€æµ‹åˆ°è‹±æ–‡ DefInjected ç›®å½•ï¼Œè¯·é€‰æ‹©æ•°æ®æ¥æºï¼š

ğŸ’¡ é€‰æ‹©å»ºè®®ï¼š
   é€‰é¡¹1: é€‚åˆæ¨¡ç»„ç¿»è¯‘æ›´æ–°ï¼Œé€Ÿåº¦å¿«ï¼ŒåŸºäºç°æœ‰ç¿»è¯‘ç»“æ„
   é€‰é¡¹2: é€‚åˆé¦–æ¬¡ç¿»è¯‘æˆ–å®Œæ•´æ£€æŸ¥ï¼Œé€Ÿåº¦æ…¢ï¼Œä½†å†…å®¹å®Œæ•´

1. ğŸ”„ ä½¿ç”¨ DefInjected ç›®å½•æå–ç¿»è¯‘ï¼ˆæ¨èï¼‰
   â””â”€â”€ åŸºäºç°æœ‰ç¿»è¯‘ç»“æ„ï¼Œå¿«é€Ÿç”Ÿæˆæ¨¡æ¿
   â””â”€â”€ é¢„è®¡æå–: ~2198 æ¡ç¿»è¯‘å†…å®¹
   
2. ğŸ” æ‰«æ Defs æ–‡ä»¶é‡æ–°æå–ï¼ˆå®Œæ•´æ‰«æï¼‰
   â””â”€â”€ ä»æºå¤´æ‰«ææ‰€æœ‰å®šä¹‰ï¼Œç¡®ä¿æ— é—æ¼
   â””â”€â”€ é¢„è®¡æå–: ~2500+ æ¡ç¿»è¯‘å†…å®¹
   
3. ğŸš« è¿”å›ä¸»èœå•

è¯·è¾“å…¥é€‰é¡¹ç¼–å·ï¼ˆ1/2/3ï¼Œå›è½¦é»˜è®¤1ï¼‰ï¼š
```

#### æƒ…å†µBï¼šæœªæ£€æµ‹åˆ°è‹±æ–‡ DefInjected ç›®å½•
```
âŒ æœªæ£€æµ‹åˆ°è‹±æ–‡ DefInjected ç›®å½•

ğŸ“‹ è‡ªåŠ¨å¤„ç†æ–¹æ¡ˆï¼š
   â””â”€â”€ å°†è‡ªåŠ¨æ‰«æ Defs æ–‡ä»¶æå–æ‰€æœ‰ç¿»è¯‘å†…å®¹
   â””â”€â”€ é¢„è®¡æå–: ~2500+ æ¡ç¿»è¯‘å†…å®¹
   â””â”€â”€ æŒ‰å®šä¹‰ç±»å‹è‡ªåŠ¨ç»„ç»‡æ–‡ä»¶ç»“æ„

ğŸš€ æŒ‰å›è½¦ç»§ç»­ï¼Œæˆ–è¾“å…¥ 'b' è¿”å›ä¸»èœå•ï¼š
```

### **ç¬¬ä¸‰æ­¥ï¼šè¾“å‡ºå†²çªå¤„ç†**ï¼ˆæ¡ä»¶åŒ–ï¼‰

#### æƒ…å†µAï¼šè¾“å‡ºç›®å½•å·²æœ‰ç¿»è¯‘æ–‡ä»¶
```
âš ï¸ æ£€æµ‹åˆ°è¾“å‡ºç›®å½•ä¸­å·²æœ‰ç¿»è¯‘æ–‡ä»¶ï¼š
   ğŸ“ DefInjected: 15 ä¸ªæ–‡ä»¶ (ä¸Šæ¬¡ä¿®æ”¹: 2025-06-27 10:30)
   ğŸ“ Keyed: 6 ä¸ªæ–‡ä»¶ (ä¸Šæ¬¡ä¿®æ”¹: 2025-06-27 10:30)

è¯·é€‰æ‹©å¤„ç†æ–¹å¼ï¼š

1. ğŸ”„ æ™ºèƒ½åˆå¹¶ï¼ˆæ¨èï¼‰
   â””â”€â”€ ä¿ç•™å·²æœ‰ç¿»è¯‘ï¼Œä»…æ·»åŠ æ–°å‘ç°çš„æ¡ç›®
   â””â”€â”€ ç”Ÿæˆåˆå¹¶æŠ¥å‘Šï¼Œæ˜¾ç¤ºæ–°å¢/æ›´æ–°å†…å®¹
   
2. ğŸ“‹ å¤‡ä»½åé‡å»º
   â””â”€â”€ å¤‡ä»½åˆ°: backup_20250627_143000/
   â””â”€â”€ ç„¶åé‡æ–°ç”Ÿæˆæ‰€æœ‰ç¿»è¯‘æ–‡ä»¶
   
3. âš ï¸ ç›´æ¥è¦†ç›–ï¼ˆå±é™©ï¼‰
   â””â”€â”€ ä¼šæ°¸ä¹…ä¸¢å¤±æ‰€æœ‰å·²æœ‰ç¿»è¯‘å†…å®¹
   
4. ğŸ“Š æŸ¥çœ‹è¯¦æƒ…åå†³å®š
   â””â”€â”€ æ˜¾ç¤ºç°æœ‰ç¿»è¯‘æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯
   
5. ğŸš« è¿”å›ä¸»èœå•

è¯·è¾“å…¥é€‰é¡¹ç¼–å·ï¼ˆ1/2/3/4/5ï¼Œå›è½¦é»˜è®¤1ï¼‰ï¼š
```

#### æƒ…å†µBï¼šè¾“å‡ºç›®å½•ä¸ºç©º
```
âœ… è¾“å‡ºç›®å½•ä¸ºç©ºï¼Œå°†åˆ›å»ºæ–°çš„ç¿»è¯‘æ–‡ä»¶ç»“æ„...

ğŸ“ å‡†å¤‡åˆ›å»ºç›®å½•ï¼š
   â”œâ”€â”€ Languages/ChineseSimplified/Keyed/
   â””â”€â”€ Languages/ChineseSimplified/DefInjected/

ğŸš€ æŒ‰å›è½¦ç»§ç»­ï¼Œæˆ–è¾“å…¥ 'b' è¿”å›ä¸»èœå•ï¼š
```

### **ç¬¬å››æ­¥ï¼šæ–‡ä»¶ç»„ç»‡æ–¹å¼**ï¼ˆæ ¹æ®æ•°æ®æ¥æºæ™ºèƒ½ç¡®å®šï¼‰

#### æƒ…å†µAï¼šä½¿ç”¨ DefInjected ç›®å½•æå–
```
ğŸ“‚ æ–‡ä»¶ç»„ç»‡æ–¹å¼ï¼š
   â””â”€â”€ å°†æŒ‰è‹±æ–‡ç¿»è¯‘æ–‡ä»¶çš„ç°æœ‰ç»“æ„ç»„ç»‡ä¸­æ–‡ç¿»è¯‘æ–‡ä»¶
   â””â”€â”€ ä¿æŒä¸åŸå§‹æ¨¡ç»„ç›¸åŒçš„ç›®å½•ç»“æ„å’Œæ–‡ä»¶å

âœ… é…ç½®å®Œæˆï¼Œå‡†å¤‡å¼€å§‹æå–...

ğŸ“Š é¢„ä¼°å·¥ä½œé‡ï¼š
   â”œâ”€â”€ Keyed ç¿»è¯‘: ~541 æ¡ (é¢„è®¡ 30 ç§’)
   â”œâ”€â”€ DefInjected ç¿»è¯‘: ~2198 æ¡ (é¢„è®¡ 2 åˆ†é’Ÿ)
   â””â”€â”€ æ€»è®¡: ~2739 æ¡ç¿»è¯‘å†…å®¹

ğŸš€ å¼€å§‹æå–ç¿»è¯‘å†…å®¹...
```

#### æƒ…å†µBï¼šæ‰«æ Defs æ–‡ä»¶æå–
```
è¯·é€‰æ‹©æ–‡ä»¶ç»„ç»‡æ–¹å¼ï¼š

1. ğŸ“‹ æŒ‰å®šä¹‰ç±»å‹åˆ†ç»„ï¼ˆæ¨èï¼‰
   â””â”€â”€ ThingDefsã€PawnKindDefsã€JobDefs ç­‰
   â””â”€â”€ ä¾¿äºç¿»è¯‘å·¥ä½œåˆ†ç±»ç®¡ç†
   
2. ğŸ“ æŒ‰æºæ–‡ä»¶è·¯å¾„ç»„ç»‡
   â””â”€â”€ ä¿æŒä¸ Defs ç›®å½•ç›¸åŒçš„ç»“æ„
   â””â”€â”€ ä¾¿äºå¯¹ç…§åŸå§‹å®šä¹‰æ–‡ä»¶
   
3. ğŸš« è¿”å›ä¸»èœå•

è¯·è¾“å…¥é€‰é¡¹ç¼–å·ï¼ˆ1/2/3ï¼Œå›è½¦é»˜è®¤1ï¼‰ï¼š
```

## ğŸ› ï¸ **æŠ€æœ¯å®ç°è¦ç‚¹**

### 1. çŠ¶æ€æ£€æµ‹å‡½æ•°
```python
def detect_extraction_environment(mod_dir: str, output_dir: str) -> dict:
    """å…¨é¢æ£€æµ‹æå–ç¯å¢ƒçŠ¶æ€"""
    return {
        'english_definjected': {
            'exists': bool,
            'path': str,
            'file_count': int,
            'size_mb': float
        },
        'english_keyed': {
            'exists': bool,
            'path': str, 
            'file_count': int,
            'size_mb': float
        },
        'output_definjected': {
            'exists': bool,
            'path': str,
            'file_count': int,
            'last_modified': datetime
        },
        'output_keyed': {
            'exists': bool,
            'path': str,
            'file_count': int, 
            'last_modified': datetime
        }
    }
```

### 2. æ¡ä»¶åŒ–æµç¨‹æ§åˆ¶
```python
def smart_extraction_workflow(mod_dir: str, output_dir: str) -> ExtractionConfig:
    """æ™ºèƒ½æå–å·¥ä½œæµ"""
    # ç¬¬ä¸€æ­¥ï¼šçŠ¶æ€æ£€æµ‹
    env_status = detect_extraction_environment(mod_dir, output_dir)
    
    # ç¬¬äºŒæ­¥ï¼šæ ¹æ®æ£€æµ‹ç»“æœç¡®å®šæµç¨‹
    if env_status['english_definjected']['exists']:
        source_choice = prompt_data_source_choice(env_status)
    else:
        source_choice = 'defs'  # è‡ªåŠ¨é€‰æ‹©
        
    # ç¬¬ä¸‰æ­¥ï¼šå†²çªå¤„ç†
    if has_existing_translations(env_status):
        conflict_resolution = prompt_conflict_resolution(env_status)
    else:
        conflict_resolution = 'create_new'
        
    # ç¬¬å››æ­¥ï¼šç»„ç»‡æ–¹å¼
    if source_choice == 'definjected':
        organization = 'preserve_structure'  # è‡ªåŠ¨ç¡®å®š
    else:
        organization = prompt_organization_choice()
        
    return ExtractionConfig(
        source=source_choice,
        conflict_resolution=conflict_resolution,
        organization=organization
    )
```

### 3. è¿›åº¦å’ŒçŠ¶æ€åé¦ˆ
```python
class ExtractionProgress:
    """æå–è¿›åº¦ç®¡ç†"""
    
    def __init__(self, total_estimated: int):
        self.total_estimated = total_estimated
        self.current = 0
        
    def show_status_detection(self):
        """æ˜¾ç¤ºçŠ¶æ€æ£€æµ‹è¿›åº¦"""
        
    def show_extraction_progress(self, current: int, current_file: str):
        """æ˜¾ç¤ºæå–è¿›åº¦"""
        
    def show_completion_summary(self, results: ExtractionResults):
        """æ˜¾ç¤ºå®Œæˆæ€»ç»“"""
```

## ğŸ“ **å®ç°ä»»åŠ¡æ¸…å•**

### Phase 1: æ ¸å¿ƒæ£€æµ‹åŠŸèƒ½
- [ ] å®ç° `detect_extraction_environment()` å‡½æ•°
- [ ] æ·»åŠ è·¯å¾„æ£€æµ‹å’Œæ–‡ä»¶ç»Ÿè®¡åŠŸèƒ½
- [ ] å®ç°çŠ¶æ€æ˜¾ç¤ºç•Œé¢

### Phase 2: æ¡ä»¶åŒ–ç”¨æˆ·ç•Œé¢
- [ ] é‡å†™æ•°æ®æ¥æºé€‰æ‹©é€»è¾‘
- [ ] å®ç°å†²çªå¤„ç†é€‰æ‹©ç•Œé¢
- [ ] æ·»åŠ æ–‡ä»¶ç»„ç»‡æ–¹å¼é€‰æ‹©

### Phase 3: æ™ºèƒ½æµç¨‹æ§åˆ¶
- [ ] å®ç° `smart_extraction_workflow()` ä¸»æ§åˆ¶å™¨
- [ ] æ·»åŠ è‡ªåŠ¨å†³ç­–é€»è¾‘
- [ ] é›†æˆè¿›åº¦åé¦ˆç³»ç»Ÿ

### Phase 4: é”™è¯¯å¤„ç†å’Œç”¨æˆ·ä½“éªŒ
- [ ] æ·»åŠ è¯¦ç»†çš„é”™è¯¯æç¤º
- [ ] å®ç°å¤‡ä»½å’Œå›æ»šæœºåˆ¶
- [ ] ä¼˜åŒ–æˆåŠŸåé¦ˆç•Œé¢

### Phase 5: é›†æˆæµ‹è¯•
- [ ] æµ‹è¯•å„ç§ç¯å¢ƒç»„åˆ
- [ ] éªŒè¯æµç¨‹é€»è¾‘æ­£ç¡®æ€§
- [ ] ç”¨æˆ·ä½“éªŒæµ‹è¯•å’Œä¼˜åŒ–

## ğŸ¯ **é¢„æœŸæ•ˆæœ**

### ç”¨æˆ·ä½“éªŒæ”¹è¿›
1. **æ¸…æ™°çš„çŠ¶æ€è®¤çŸ¥**ï¼šç”¨æˆ·ä¸€å¼€å§‹å°±çŸ¥é“å½“å‰ç¯å¢ƒçŠ¶æ€
2. **å‡å°‘å†³ç­–è´Ÿæ‹…**ï¼šåªåœ¨å¿…è¦æ—¶è¯¢é—®ï¼Œæä¾›æ˜ç¡®å»ºè®®
3. **æ™ºèƒ½é»˜è®¤é€‰æ‹©**ï¼šæ ¹æ®ç¯å¢ƒçŠ¶æ€æä¾›åˆç†çš„é»˜è®¤é€‰é¡¹
4. **å®Œæ•´çš„åé¦ˆå¾ªç¯**ï¼šä»æ£€æµ‹åˆ°å®Œæˆçš„å…¨ç¨‹çŠ¶æ€åé¦ˆ

### æŠ€æœ¯è´¨é‡æå‡
1. **å‡å°‘ç”¨æˆ·é”™è¯¯**ï¼šé€šè¿‡æ£€æµ‹å’ŒéªŒè¯é¿å…å¸¸è§é”™è¯¯
2. **æé«˜æˆåŠŸç‡**ï¼šæ™ºèƒ½å¤„ç†å„ç§è¾¹ç•Œæƒ…å†µ
3. **æ›´å¥½çš„å¯ç»´æŠ¤æ€§**ï¼šæ¸…æ™°çš„æµç¨‹åˆ†ç¦»å’Œæ¨¡å—åŒ–è®¾è®¡
4. **å®Œå–„çš„é”™è¯¯å¤„ç†**ï¼šé¢„é˜²å’Œå¤„ç†å„ç§å¼‚å¸¸æƒ…å†µ

## ğŸ“‹ **åç»­ä¼˜åŒ–æ–¹å‘**

1. **æ·»åŠ é…ç½®ä¿å­˜**ï¼šè®°ä½ç”¨æˆ·çš„å¸¸ç”¨é€‰æ‹©
2. **æ‰¹é‡å¤„ç†æ”¯æŒ**ï¼šæ”¯æŒå¤šä¸ªæ¨¡ç»„çš„æ‰¹é‡æå–
3. **å¢é‡æ›´æ–°**ï¼šæ™ºèƒ½æ£€æµ‹å˜åŒ–ï¼Œåªå¤„ç†æ›´æ–°çš„å†…å®¹
4. **è‡ªå®šä¹‰è¿‡æ»¤**ï¼šå…è®¸ç”¨æˆ·è‡ªå®šä¹‰æå–è§„åˆ™å’Œè¿‡æ»¤æ¡ä»¶

---

**åˆ›å»ºæ—¶é—´**: 2025-06-27  
**çŠ¶æ€**: è®¾è®¡å®Œæˆï¼Œå¾…å®ç°  
**ä¼˜å…ˆçº§**: é«˜ï¼ˆç”¨æˆ·ä½“éªŒæ ¸å¿ƒæ”¹è¿›ï¼‰
